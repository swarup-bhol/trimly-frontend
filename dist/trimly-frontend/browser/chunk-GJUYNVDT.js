import{a as H}from"./chunk-SKHF3YWI.js";import{a as Q,b as X,c as Z,h as ee}from"./chunk-JAUZOHJ2.js";import{$ as o,A as a,Ca as Y,Ga as U,H as b,Ha as J,Ia as q,J as d,K as S,L as T,M as E,N as A,P as _,Q as M,R as f,S as h,T as n,U as i,V as w,W as D,X as v,Y as g,Z as m,_ as N,aa as x,ba as C,ca as B,da as j,ea as O,fa as P,ga as R,ia as G,ja as $,na as V,o as I,q as L,ra as F,u as p,v as u,va as W,xa as K}from"./chunk-EMWRS4DM.js";var y=(t,s)=>s.id,te=(t,s)=>s.n,z=()=>[1,2,3,4,5];function ie(t,s){t&1&&w(0,"div",10)}function ne(t,s){if(t&1&&(n(0,"span",24),o(1),i()),t&2){let e=m().$implicit;a(),x(e.badge)}}function oe(t,s){if(t&1){let e=v();n(0,"button",23),g("click",function(){let r=p(e).$implicit,c=m();return u(c.switchTab(r.id))}),n(1,"span"),o(2),i(),o(3),d(4,ne,2,1,"span",24),i()}if(t&2){let e=s.$implicit,l=m();E("on",l.tab()===e.id),a(2),x(e.icon),a(),C(" ",e.label," "),a(),_(4,e.badge&&e.badge>0?4:-1)}}function ae(t,s){t&1&&D(0)}function le(t,s){if(t&1&&d(0,ae,1,0,"ng-container",25),t&2){m();let e=N(35);S("ngTemplateOutlet",e)}}function re(t,s){t&1&&D(0)}function se(t,s){if(t&1&&d(0,re,1,0,"ng-container",25),t&2){m();let e=N(37);S("ngTemplateOutlet",e)}}function me(t,s){t&1&&D(0)}function ce(t,s){if(t&1&&d(0,me,1,0,"ng-container",25),t&2){m();let e=N(39);S("ngTemplateOutlet",e)}}function de(t,s){t&1&&D(0)}function _e(t,s){if(t&1&&d(0,de,1,0,"ng-container",25),t&2){m();let e=N(41);S("ngTemplateOutlet",e)}}function pe(t,s){if(t&1&&(n(0,"span",28),o(1),i()),t&2){let e=m().$implicit;a(),x(e.badge)}}function ue(t,s){if(t&1){let e=v();n(0,"button",26),g("click",function(){let r=p(e).$implicit,c=m();return u(c.switchTab(r.id))}),n(1,"span",27),o(2),d(3,pe,2,1,"span",28),i(),o(4),i()}if(t&2){let e=s.$implicit,l=m();E("on",l.tab()===e.id),a(2),C("",e.icon," "),a(),_(3,e.badge&&e.badge>0?3:-1),a(),C(" ",e.label," ")}}function xe(t,s){t&1&&(n(0,"div",33),w(1,"div",34),n(2,"span"),o(3,"Finding nearby barbers..."),i()())}function Ce(t,s){t&1&&(n(0,"div",35)(1,"div",36),o(2,"\u{1F3EA}"),i(),n(3,"div",37),o(4,"No active shops found. Check back soon!"),i()())}function ge(t,s){if(t&1&&(n(0,"span",47),o(1),i()),t&2){let e=s.$implicit;a(),x(e.name)}}function ve(t,s){if(t&1&&(n(0,"span",47),o(1),i()),t&2){let e=m().$implicit;a(),C("+",e.services.length-3," more")}}function be(t,s){if(t&1&&(n(0,"span"),o(1,"\u2605"),i()),t&2){let e=s.$implicit,l=m(2).$implicit;E("star-empty",e>(l.rating||0))}}function fe(t,s){if(t&1&&(f(0,be,2,2,"span",51,M),n(2,"span",50),o(3),i()),t&2){let e=m().$implicit;h($(1,z)),a(3),C("(",e.reviews,")")}}function he(t,s){t&1&&(n(0,"span",52),o(1,"New shop"),i())}function Se(t,s){if(t&1){let e=v();n(0,"div",40),g("click",function(){let r=p(e).$implicit,c=m(3);return u(c.startBooking(r))}),n(1,"div",41)(2,"span",42),o(3),i()(),n(4,"div",43)(5,"div",44),o(6),i(),n(7,"div",45),o(8),i(),n(9,"div",46),f(10,ge,2,1,"span",47,y),d(12,ve,2,1,"span",47),i(),n(13,"div",48)(14,"div",49),d(15,fe,4,2,"span",50)(16,he,2,0),i(),n(17,"span"),o(18),i()()()()}if(t&2){let e=s.$implicit;E("closed",!e.isOpen),a(),T("background","linear-gradient(135deg,"+(e.color1||"#1a1200")+","+(e.color2||"#0d0d1a")+")"),a(2),x(e.emoji||"\u2702\uFE0F"),a(3),x(e.shopName),a(2),C("\u{1F4CD} ",e.location,""),a(2),h(e.services.slice(0,3)),a(2),_(12,e.services.length>3?12:-1),a(3),_(15,e.rating?15:16),a(2),A(e.isOpen?"open-badge ob-open":"open-badge ob-closed"),a(),x(e.isOpen?"\u25CF Open":"\u25CF Closed")}}function Ee(t,s){if(t&1&&(n(0,"div",38),f(1,Se,19,12,"div",39,y),i()),t&2){let e=m(2);a(),h(e.shops())}}function ke(t,s){if(t&1&&(n(0,"div",29)(1,"div",30)(2,"div",31),o(3,"FIND A BARBER"),i(),n(4,"div",32),o(5,"Browse shops, pick a slot, walk in fresh \u2702\uFE0F"),i()(),d(6,xe,4,0,"div",33)(7,Ce,5,0)(8,Ee,3,0),i()),t&2){let e=m();a(6),_(6,e.loadingShops()?6:e.shops().length===0?7:8)}}function Te(t,s){if(t&1){let e=v();n(0,"div",29)(1,"div",35)(2,"div",36),o(3,"\u{1F3EA}"),i(),n(4,"div",37),o(5,"Select a shop from Explore to book"),i(),n(6,"button",54),g("click",function(){p(e);let r=m(2);return u(r.tab.set("explore"))}),o(7,"Browse Shops \u2192"),i()()()}}function we(t,s){if(t&1&&(n(0,"div",64)(1,"div",66)(2,"span",67),o(3,"Booking ID"),i(),n(4,"span",68),o(5),i()(),n(6,"div",66)(7,"span",67),o(8,"Shop"),i(),n(9,"span"),o(10),i()(),n(11,"div",66)(12,"span",67),o(13,"Service"),i(),n(14,"span"),o(15),i()(),n(16,"div",66)(17,"span",67),o(18,"Slot"),i(),n(19,"span"),o(20),i()(),n(21,"div",66)(22,"span",67),o(23,"Duration"),i(),n(24,"span"),o(25),i()(),n(26,"div",66)(27,"span",69),o(28,"Amount"),i(),n(29,"span",70),o(30),i()()()),t&2){let e=m(3);a(5),C("#",e.bookingSuccess().id,""),a(5),B("",e.selectedShop().emoji||"\u2702\uFE0F"," ",e.selectedShop().shopName,""),a(5),x(e.bookingSuccess().servicesLabel),a(5),B("",e.bookingSuccess().bookingDate," \xB7 ",e.bookingSuccess().slot,""),a(5),C("",e.bookingSuccess().duration," min"),a(5),C("\u20B9",e.bookingSuccess().amount,"")}}function ye(t,s){if(t&1){let e=v();n(0,"div",55)(1,"div",56)(2,"div",57),o(3,"\u{1F389}"),i(),n(4,"div",58),o(5,"BOOKING SENT!"),i(),n(6,"div",59),o(7," Your request is with "),n(8,"strong"),o(9),i(),o(10,". They've been notified and will confirm shortly. "),i(),n(11,"div",60)(12,"div",61),o(13,"\u{1F514}"),i(),n(14,"div")(15,"div",62),o(16,"Barber Notified In-App \u2713"),i(),n(17,"div",63),o(18),i()()(),d(19,we,31,8,"div",64),n(20,"button",65),g("click",function(){p(e);let r=m(2);return u(r.resetBooking())}),o(21,"\u2190 Book Another"),i()()()}if(t&2){let e=m(2);a(9),x(e.selectedShop().shopName),a(9),C("",e.selectedShop().ownerName," received your request. You'll get a notification here when they respond."),a(),_(19,e.bookingSuccess()?19:-1)}}function Ie(t,s){t&1&&o(0," \u2713 ")}function Be(t,s){if(t&1&&o(0),t&2){let e=m().$implicit;C(" ",e.n," ")}}function Fe(t,s){if(t&1&&w(0,"div",78),t&2){let e=m().$implicit,l=m(3);E("done",l.bookingStep()>e.n)}}function De(t,s){if(t&1&&(n(0,"div",74)(1,"div",75),d(2,Ie,1,0)(3,Be,1,1),i(),n(4,"span",76),o(5),i()(),d(6,Fe,1,2,"div",77)),t&2){let e=s.$implicit,l=s.$index,r=m(3);a(),E("done",r.bookingStep()>e.n)("active",r.bookingStep()===e.n)("todo",r.bookingStep()<e.n),a(),_(2,r.bookingStep()>e.n?2:3),a(2),E("done",r.bookingStep()>e.n)("active",r.bookingStep()===e.n)("todo",r.bookingStep()<e.n),a(),x(e.label),a(),_(6,l<r.steps.length-1?6:-1)}}function Ne(t,s){if(t&1){let e=v();n(0,"div",86),g("click",function(){p(e);let r=m().$implicit,c=m(4);return u(c.toggleSvc(r))}),n(1,"div",87),o(2),i(),n(3,"div",88)(4,"div",89),o(5),i(),n(6,"div",90),o(7),i()(),n(8,"div",91),o(9),i(),n(10,"div",92),o(11),i()()}if(t&2){let e=m().$implicit,l=m(4);T("border-color",l.isSelected(e.id)?"var(--amber)":"")("background",l.isSelected(e.id)?"rgba(245,166,35,0.04)":""),a(2),x(e.icon||"\u2702\uFE0F"),a(3),x(e.name),a(2),B("\u23F1 ",e.duration,"min",e.description?" \xB7 "+e.description:"",""),a(2),C("\u20B9",e.price,""),a(2),x(l.isSelected(e.id)?"\u2705":"\u25CB")}}function Ve(t,s){if(t&1&&d(0,Ne,12,10,"div",85),t&2){let e=s.$implicit;_(0,e.enabled?0:-1)}}function Me(t,s){if(t&1&&(n(0,"div",83)(1,"div",66)(2,"span",67),o(3,"Services"),i(),n(4,"span"),o(5),i()(),n(6,"div",66)(7,"span",67),o(8,"Duration"),i(),n(9,"span"),o(10),i()(),n(11,"div",66)(12,"span",69),o(13,"Total"),i(),n(14,"span",70),o(15),i()()()),t&2){let e=m(4);a(5),x(e.selectedServiceNames()),a(5),C("",e.totalDuration()," min"),a(5),C("\u20B9",e.totalAmount(),"")}}function Oe(t,s){if(t&1){let e=v();n(0,"div",79)(1,"div",80)(2,"div",81),o(3,"Select Services"),i(),n(4,"span",82),o(5),i()(),f(6,Ve,1,1,null,null,y),i(),d(8,Me,16,3,"div",83),n(9,"button",84),g("click",function(){p(e);let r=m(3);return u(r.bookingStep.set(2))}),o(10,"Next: Choose Slot \u2192"),i()}if(t&2){let e=m(3);a(5),C("",e.selectedServices().length," selected"),a(),h(e.selectedShop().services),a(2),_(8,e.selectedServices().length>0?8:-1),a(),S("disabled",e.selectedServices().length===0)}}function Pe(t,s){t&1&&(n(0,"div",96),w(1,"div",34),i())}function Re(t,s){if(t&1){let e=v();n(0,"button",102),g("click",function(){let r=p(e).$implicit,c=m(5);return u(c.selectSlot(r))}),o(1),i()}if(t&2){let e=s.$implicit,l=m(5);E("s-sel",(l.selectedSlot==null?null:l.selectedSlot.id)===e.id)("s-off",e.taken)("s-dis",e.disabled),S("disabled",e.taken||e.disabled),a(),C(" ",e.label," ")}}function $e(t,s){if(t&1&&(n(0,"div",100),f(1,Re,2,8,"button",101,y),i()),t&2){let e=m(4);a(),h(e.slots())}}function Ae(t,s){if(t&1){let e=v();n(0,"div",79)(1,"div",80)(2,"div",81),o(3,"Choose Your Slot"),i()(),n(4,"div",93)(5,"label",94),o(6,"Date"),i(),n(7,"input",95),R("ngModelChange",function(r){p(e);let c=m(3);return P(c.selectedDate,r)||(c.selectedDate=r),u(r)}),g("change",function(){p(e);let r=m(3);return u(r.loadSlots())}),i()(),d(8,Pe,2,0,"div",96)(9,$e,3,0),i(),n(10,"div",97)(11,"button",98),g("click",function(){p(e);let r=m(3);return u(r.bookingStep.set(1))}),o(12,"\u2190 Back"),i(),n(13,"button",99),g("click",function(){p(e);let r=m(3);return u(r.bookingStep.set(3))}),o(14,"Next: Confirm \u2192"),i()()}if(t&2){let e=m(3);a(7),O("ngModel",e.selectedDate),S("min",e.today),a(),_(8,e.loadingSlots()?8:9),a(5),S("disabled",!e.selectedSlot)}}function ze(t,s){if(t&1&&(n(0,"div",105),o(1),i()),t&2){let e=m(4);a(),x(e.bookingErr())}}function Le(t,s){t&1&&w(0,"span",106)}function je(t,s){if(t&1){let e=v();n(0,"div",79)(1,"div",80)(2,"div",81),o(3,"Confirm Booking"),i()(),n(4,"div",103)(5,"div",66)(6,"span",67),o(7,"Shop"),i(),n(8,"span"),o(9),i()(),n(10,"div",66)(11,"span",67),o(12,"Services"),i(),n(13,"span"),o(14),i()(),n(15,"div",66)(16,"span",67),o(17,"Slot"),i(),n(18,"span"),o(19),i()(),n(20,"div",66)(21,"span",67),o(22,"Duration"),i(),n(23,"span"),o(24),i()(),n(25,"div",66)(26,"span",69),o(27,"Total"),i(),n(28,"span",70),o(29),i()()(),n(30,"div",93)(31,"label",94),o(32,"Your Name"),i(),n(33,"input",104),R("ngModelChange",function(r){p(e);let c=m(3);return P(c.customerName,r)||(c.customerName=r),u(r)}),i()(),n(34,"div",93)(35,"label",94),o(36,"Phone"),i(),n(37,"input",104),R("ngModelChange",function(r){p(e);let c=m(3);return P(c.customerPhone,r)||(c.customerPhone=r),u(r)}),i()()(),d(38,ze,2,1,"div",105),n(39,"div",97)(40,"button",98),g("click",function(){p(e);let r=m(3);return u(r.bookingStep.set(2))}),o(41,"\u2190 Back"),i(),n(42,"button",99),g("click",function(){p(e);let r=m(3);return u(r.submitBooking())}),d(43,Le,1,0,"span",106),o(44),i()()}if(t&2){let e=m(3);a(9),B("",e.selectedShop().emoji||"\u2702\uFE0F"," ",e.selectedShop().shopName,""),a(5),x(e.selectedServiceNames()),a(5),B("",e.selectedDate," \xB7 ",e.selectedSlot==null?null:e.selectedSlot.label,""),a(5),C("",e.totalDuration()," min"),a(5),C("\u20B9",e.totalAmount(),""),a(4),O("ngModel",e.customerName),a(4),O("ngModel",e.customerPhone),a(),_(38,e.bookingErr()?38:-1),a(4),S("disabled",e.submittingBooking()),a(),_(43,e.submittingBooking()?43:-1),a(),C(" ",e.submittingBooking()?"Booking...":"Confirm Booking \u2192"," ")}}function Ge(t,s){if(t&1&&(n(0,"div",30)(1,"div",71),o(2,"Booking \xB7 "),n(3,"span",72),o(4),i()(),n(5,"div",31),o(6,"BOOK APPOINTMENT"),i()(),n(7,"div",73),f(8,De,7,15,null,null,te),i(),d(10,Oe,11,3)(11,Ae,15,4)(12,je,45,13)),t&2){let e=m(2);a(4),x(e.selectedShop().shopName),a(4),h(e.steps),a(2),_(10,e.bookingStep()===1?10:-1),a(),_(11,e.bookingStep()===2?11:-1),a(),_(12,e.bookingStep()===3?12:-1)}}function We(t,s){if(t&1&&(n(0,"div",53),d(1,Te,8,0,"div",29)(2,ye,22,3)(3,Ge,13,4),i()),t&2){let e=m();a(),_(1,e.selectedShop()?e.bookingSuccess()?2:3:1)}}function Ke(t,s){t&1&&(n(0,"div",33),w(1,"div",34),n(2,"span"),o(3,"Loading bookings..."),i()())}function Ye(t,s){if(t&1){let e=v();n(0,"div",35)(1,"div",36),o(2,"\u{1F4CB}"),i(),n(3,"div",37),o(4,"No bookings yet. Book your first appointment!"),i(),n(5,"button",54),g("click",function(){p(e);let r=m(2);return u(r.tab.set("explore"))}),o(6,"Browse Shops \u2192"),i()()}}function Ue(t,s){t&1&&(n(0,"span",115),o(1,"\u23F3 Awaiting barber confirmation"),i())}function Je(t,s){if(t&1&&(n(0,"span",116),o(1),i()),t&2){let e=m().$implicit;a(),C("\u2713 Walk in at ",e.slot,"")}}function qe(t,s){if(t&1){let e=v();n(0,"button",123),g("click",function(){let r=p(e).$implicit,c=m(2).$implicit,k=m(3);return u(k.rateBooking(c.id,r))})("mouseenter",function(){let r=p(e).$implicit,c=m(5);return u(c.hoverRating=r)})("mouseleave",function(){p(e);let r=m(5);return u(r.hoverRating=0)}),o(1,"\u2605"),i()}if(t&2){let e=s.$implicit,l=m(5);T("color",e<=l.hoverRating?"var(--amber)":"var(--border2)")}}function He(t,s){t&1&&(n(0,"div",117)(1,"div",120),o(2,"Rate your experience:"),i(),n(3,"div",121),f(4,qe,2,2,"button",122,M),i()()),t&2&&(a(4),h($(0,z)))}function Qe(t,s){if(t&1&&(n(0,"span"),o(1,"\u2605"),i()),t&2){let e=s.$implicit,l=m(2).$implicit;T("color",e<=l.rating?"var(--amber)":"var(--border2)")}}function Xe(t,s){t&1&&(n(0,"div",118),f(1,Qe,2,2,"span",124,M),n(3,"span",125),o(4,"Your rating"),i()()),t&2&&(a(),h($(0,z)))}function Ze(t,s){if(t&1){let e=v();n(0,"button",126),g("click",function(){p(e);let r=m().$implicit,c=m(3);return u(c.cancelBooking(r.id))}),o(1,"Cancel"),i()}}function et(t,s){if(t&1&&(n(0,"div",107)(1,"div",108),o(2),i(),n(3,"div",109)(4,"div",110),o(5),i(),n(6,"div",111),o(7),i(),n(8,"div",112)(9,"span",113),o(10),i(),n(11,"span",114),o(12),i(),d(13,Ue,2,0,"span",115)(14,Je,2,1,"span",116),i(),d(15,He,6,1,"div",117)(16,Xe,5,1,"div",118)(17,Ze,2,0,"button",119),i()()),t&2){let e=s.$implicit,l=m(3);a(2),x(e.shopEmoji||"\u2702\uFE0F"),a(3),x(e.shopName),a(2),j("\u2702\uFE0F ",e.servicesLabel," \xB7 \u{1F550} ",e.slot," \xB7 \u23F1 ",e.duration,"min"),a(2),A(l.statusClass(e.status)),a(),x(l.statusLabel(e.status)),a(2),C("\u20B9",e.amount,""),a(),_(13,e.status==="PENDING"?13:-1),a(),_(14,e.status==="CONFIRMED"?14:-1),a(),_(15,e.status==="COMPLETED"&&!e.rating?15:-1),a(),_(16,e.rating&&e.rating>0?16:-1),a(),_(17,e.status==="PENDING"||e.status==="CONFIRMED"?17:-1)}}function tt(t,s){if(t&1&&f(0,et,18,14,"div",107,y),t&2){let e=m(2);h(e.myBookings())}}function it(t,s){if(t&1&&(n(0,"div",29)(1,"div",30)(2,"div",31),o(3,"MY BOOKINGS"),i(),n(4,"div",32),o(5,"Your appointment history"),i()(),d(6,Ke,4,0,"div",33)(7,Ye,7,0)(8,tt,2,0),i()),t&2){let e=m();a(6),_(6,e.loadingMyBookings()?6:e.myBookings().length===0?7:8)}}function nt(t,s){if(t&1){let e=v();n(0,"button",130),g("click",function(){p(e);let r=m(2);return u(r.markAllRead())}),o(1,"Mark all read"),i()}}function ot(t,s){t&1&&(n(0,"div",35)(1,"div",36),o(2,"\u{1F514}"),i(),n(3,"div",37),o(4,"No notifications yet. Book an appointment to get started!"),i()())}function at(t,s){t&1&&w(0,"span",136)}function lt(t,s){if(t&1){let e=v();n(0,"div",131),g("click",function(){let r=p(e).$implicit,c=m(2);return u(c.markRead(r.id))}),n(1,"div",132),o(2),i(),n(3,"div",133)(4,"div",134)(5,"div",135),o(6),i(),d(7,at,1,0,"span",136),i(),n(8,"div",137),o(9),i(),n(10,"div",138),o(11),i()()()}if(t&2){let e=s.$implicit,l=m(2);T("background",e.isRead?"var(--card)":"rgba(245,166,35,0.04)")("border","1px solid "+(e.isRead?"var(--border)":"rgba(245,166,35,0.2)")),a(),T("background",l.notifBg(e.type)),a(),C(" ",l.notifIcon(e.type)," "),a(3),T("color",e.isRead?"var(--text)":l.notifColor(e.type)),a(),x(e.title),a(),_(7,e.isRead?-1:7),a(2),x(e.body),a(2),x(l.timeAgo(e.createdAt))}}function rt(t,s){if(t&1&&(n(0,"div",29)(1,"div",30)(2,"div",127)(3,"div")(4,"div",31),o(5,"NOTIFICATIONS"),i(),n(6,"div",32),o(7,"Updates on your bookings"),i()(),d(8,nt,2,0,"button",128),i()(),d(9,ot,5,0,"div",35),f(10,lt,12,13,"div",129,y),i()),t&2){let e=m();a(8),_(8,e.hasUnreadNotifications()?8:-1),a(),_(9,e.notifications().length===0?9:-1),a(),h(e.notifications())}}var ht=(()=>{class t{constructor(){this.api=I(J),this.authSvc=I(q),this.toast=I(U),this.notifSvc=I(H),this.route=I(Y),this.tab=b("explore"),this.shops=b([]),this.selectedShop=b(null),this.loadingShops=b(!0),this.bookingStep=b(1),this.slots=b([]),this.loadingSlots=b(!1),this.selectedServices=b([]),this.selectedSlot=null,this.selectedDate=new Date().toISOString().split("T")[0],this.today=new Date().toISOString().split("T")[0],this.customerName="",this.customerPhone="",this.submittingBooking=b(!1),this.bookingErr=b(null),this.bookingSuccess=b(null),this.myBookings=b([]),this.loadingMyBookings=b(!1),this.notifications=b([]),this.hoverRating=0,this.session=this.authSvc.session,this.unreadCount=this.notifSvc.unreadCount,this.initials=F(()=>this.session()?.name?.charAt(0)?.toUpperCase()??"C"),this.steps=[{n:1,label:"Services"},{n:2,label:"Slot"},{n:3,label:"Confirm"}],this.hasUnreadNotifications=F(()=>this.notifications().some(e=>!e.isRead)),this.selectedServiceNames=F(()=>this.selectedServices().map(e=>e.name).join(", ")),this.totalDuration=F(()=>this.selectedServices().reduce((e,l)=>e+l.duration,0)),this.totalAmount=F(()=>this.selectedServices().reduce((e,l)=>e+l.price,0))}get navItems(){let e=this.notifications().filter(l=>!l.isRead).length;return[{id:"explore",icon:"\u{1F50D}",label:"Explore",badge:0},{id:"mybookings",icon:"\u{1F4CB}",label:"My Bookings",badge:0},{id:"notifications",icon:"\u{1F514}",label:"Notifications",badge:e}]}ngOnInit(){let e=this.session();e&&(this.customerName=e.name),this.loadShops(),this.loadMyBookings(),this.loadNotifications(),this.route.queryParams.subscribe(l=>{l.shop&&this.api.get(`/shops/public/${l.shop}`).subscribe({next:r=>{this.startBooking(r)},error:()=>{}})})}loadShops(){this.loadingShops.set(!0),this.api.get("/shops/public").subscribe({next:e=>{this.shops.set(e),this.loadingShops.set(!1)},error:()=>this.loadingShops.set(!1)})}loadMyBookings(){this.loadingMyBookings.set(!0),this.api.get("/bookings/my").subscribe({next:e=>{this.myBookings.set(e),this.loadingMyBookings.set(!1)},error:()=>this.loadingMyBookings.set(!1)})}loadNotifications(){this.api.get("/notifications").subscribe({next:e=>this.notifications.set(e)})}switchTab(e){this.tab.set(e),e==="mybookings"&&this.loadMyBookings(),e==="notifications"&&this.loadNotifications()}startBooking(e){this.selectedShop.set(e),this.selectedServices.set([]),this.selectedSlot=null,this.bookingStep.set(1),this.bookingSuccess.set(null),this.bookingErr.set(null),this.tab.set("booking"),this.loadSlots()}loadSlots(){let e=this.selectedShop();e&&(this.loadingSlots.set(!0),this.api.get(`/shops/${e.id}/slots`,{date:this.selectedDate}).subscribe({next:l=>{this.slots.set(l),this.loadingSlots.set(!1)},error:()=>this.loadingSlots.set(!1)}))}isSelected(e){return this.selectedServices().some(l=>l.id===e)}toggleSvc(e){this.selectedServices.update(l=>l.some(r=>r.id===e.id)?l.filter(r=>r.id!==e.id):[...l,e])}selectSlot(e){this.selectedSlot=e}submitBooking(){if(this.bookingErr.set(null),!this.customerName.trim()){this.bookingErr.set("Please enter your name");return}let e=this.selectedShop(),l=this.selectedServices(),r=this.selectedSlot;this.submittingBooking.set(!0),this.api.post("/bookings",{shopId:e.id,serviceIds:l.map(c=>c.id),slot:r.label,slotId:r.id,bookingDate:this.selectedDate,customerName:this.customerName.trim(),customerPhone:this.customerPhone.trim()}).subscribe({next:c=>{this.submittingBooking.set(!1),this.bookingSuccess.set(c),this.loadMyBookings(),this.notifSvc.refreshCount(),this.toast.show("Booking sent! \u{1F389}","Awaiting barber confirmation","ok")},error:c=>{this.submittingBooking.set(!1),this.bookingErr.set(c.error?.message||"Booking failed. Slot may have been taken.")}})}resetBooking(){this.bookingSuccess.set(null),this.bookingStep.set(1),this.selectedServices.set([]),this.selectedSlot=null,this.tab.set("explore")}cancelBooking(e){confirm("Cancel this booking?")&&this.api.patch(`/bookings/my/${e}/cancel`).subscribe({next:()=>{this.toast.show("Booking cancelled","","warn"),this.loadMyBookings()},error:()=>this.toast.show("Error","Failed to cancel","err")})}rateBooking(e,l){this.api.post(`/bookings/my/${e}/rate`,{rating:l}).subscribe({next:()=>{this.toast.show("Rating submitted! \u2B50","","ok"),this.loadMyBookings()},error:()=>this.toast.show("Error","Failed to submit rating","err")})}markRead(e){this.notifSvc.markRead(e).subscribe(()=>{this.loadNotifications(),this.notifSvc.refreshCount()})}markAllRead(){this.notifSvc.markAllRead().subscribe(()=>{this.loadNotifications(),this.notifSvc.refreshCount()})}statusLabel(e){return{PENDING:"\u23F3 Pending",CONFIRMED:"\u2713 Confirmed",COMPLETED:"\u{1F3C1} Done",REJECTED:"\u2715 Rejected",CANCELLED:"\u{1F6AB} Cancelled"}[e]||e}statusClass(e){return e==="PENDING"?"by":e==="CONFIRMED"?"bb":e==="COMPLETED"?"bm":"br"}notifIcon(e){return{NEW_BOOKING:"\u{1F4CB}",BOOKING_CONFIRMED:"\u2705",BOOKING_REJECTED:"\u274C",BOOKING_CANCELLED:"\u{1F6AB}",BOOKING_COMPLETED:"\u{1F3C1}"}[e]||"\u{1F514}"}notifColor(e){return e.includes("CONFIRMED")||e.includes("COMPLETED")?"var(--emerald)":e.includes("REJECTED")||e.includes("CANCELLED")?"var(--crimson)":"var(--amber)"}notifBg(e){return e.includes("CONFIRMED")||e.includes("COMPLETED")?"rgba(16,217,138,0.12)":e.includes("REJECTED")||e.includes("CANCELLED")?"rgba(255,59,107,0.12)":"rgba(245,166,35,0.12)"}timeAgo(e){let l=Math.floor((Date.now()-new Date(e).getTime())/1e3);return l<60?"just now":l<3600?`${Math.floor(l/60)}m ago`:`${Math.floor(l/3600)}h ago`}logout(){this.authSvc.logout()}static{this.\u0275fac=function(l){return new(l||t)}}static{this.\u0275cmp=L({type:t,selectors:[["app-customer"]],standalone:!0,features:[G],decls:42,vars:4,consts:[["exploreTpl",""],["bookingTpl",""],["myBookingsTpl",""],["notifsTpl",""],[2,"display","flex","flex-direction","column","min-height","100vh"],[1,"topbar"],[1,"topbar-brand"],[1,"sub-brand"],[1,"topbar-right"],[1,"notif-btn",3,"click"],[1,"notif-dot"],[1,"user-pill"],[1,"up-av"],[1,"up-name"],[1,"up-role"],[1,"btn","btn-ghost","btn-sm",3,"click"],[1,"main"],[1,"sidebar"],[1,"sb-sec"],[1,"sb-item",3,"on"],[1,"main-content"],[1,"mobile-nav"],[1,"mn-item",3,"on"],[1,"sb-item",3,"click"],[1,"sb-badge"],[4,"ngTemplateOutlet"],[1,"mn-item",3,"click"],[1,"mn-icon"],[1,"mn-badge"],[1,"page"],[1,"ph"],[1,"ph-title"],[1,"ph-sub"],[1,"loading-overlay"],[1,"spinner"],[1,"empty"],[1,"ei"],[1,"et"],[1,"g3"],[1,"shop-card",3,"closed"],[1,"shop-card",3,"click"],[1,"sc-banner"],[1,"sc-emoji"],[1,"sc-body"],[1,"sc-name"],[1,"sc-loc"],[1,"sc-pills"],[1,"sc-pill"],[1,"sc-foot"],[1,"stars"],[2,"font-size","11px","color","var(--text3)","margin-left","4px"],[3,"star-empty"],[2,"font-size","11px","color","var(--text3)"],[1,"page",2,"max-width","640px"],[1,"btn","btn-amber",2,"margin-top","16px",3,"click"],[1,"card","card-amber",2,"margin-top","32px"],[2,"text-align","center","padding","24px 0 16px"],[2,"font-size","72px","animation","popIn 0.5s cubic-bezier(0.22,1,0.36,1)"],[2,"font-family","'Unbounded',sans-serif","font-size","32px","font-weight","900","color","var(--amber)","margin","14px 0 8px"],[2,"color","var(--text2)","font-size","14px","max-width","320px","margin","0 auto 24px","line-height","1.7"],[2,"background","rgba(16,217,138,0.07)","border","1px solid rgba(16,217,138,0.22)","border-radius","12px","padding","14px 16px","margin-bottom","18px","display","flex","gap","12px","align-items","center","text-align","left"],[2,"width","44px","height","44px","border-radius","12px","background","rgba(16,217,138,0.12)","display","flex","align-items","center","justify-content","center","font-size","24px","flex-shrink","0"],[2,"font-weight","700","font-size","13px","color","var(--emerald)","margin-bottom","3px"],[2,"font-size","12px","color","var(--text2)","line-height","1.6"],[1,"sbox",2,"text-align","left","margin-bottom","20px"],[1,"btn","btn-amber","btn-block","btn-lg",3,"click"],[1,"srow"],[2,"color","var(--text2)"],[2,"font-family","monospace","font-size","12px","color","var(--sky)"],[2,"font-weight","700"],[1,"stotal"],[1,"ph-bc"],[1,"ph-bc-cur"],[1,"steps"],[1,"step-n"],[1,"step-c"],[1,"step-l"],[1,"step-line",3,"done"],[1,"step-line"],[1,"card",2,"margin-bottom","16px"],[1,"ch"],[1,"ct"],[2,"font-size","12px","color","var(--text3)"],[1,"sbox",2,"margin-bottom","16px"],[1,"btn","btn-amber","btn-block",3,"click","disabled"],[1,"svc",3,"border-color","background"],[1,"svc",3,"click"],[1,"svc-ico"],[1,"svc-body"],[1,"svc-name"],[1,"svc-meta"],[1,"svc-price"],[2,"margin-left","12px","font-size","20px"],[1,"fg"],[1,"fl"],["type","date",1,"fi",3,"ngModelChange","change","ngModel","min"],[2,"text-align","center","padding","20px"],[2,"display","flex","gap","10px"],[1,"btn","btn-outline",3,"click"],[1,"btn","btn-amber",2,"flex","1",3,"click","disabled"],[1,"slot-grid"],[1,"slot",3,"s-sel","s-off","s-dis","disabled"],[1,"slot",3,"click","disabled"],[1,"sbox",2,"margin-bottom","20px"],[1,"fi",3,"ngModelChange","ngModel"],[1,"err-banner",2,"margin-bottom","12px"],[1,"spinner",2,"width","16px","height","16px","border-width","2px"],[1,"pb-card"],[1,"pb-ico"],[2,"flex","1","min-width","0"],[2,"font-weight","700","font-size","14px","margin-bottom","2px"],[2,"font-size","12px","color","var(--text2)","margin-bottom","6px"],[2,"display","flex","gap","6px","flex-wrap","wrap","align-items","center"],[1,"badge"],[1,"badge","bm"],[2,"font-size","11px","color","var(--amber)"],[2,"font-size","11px","color","var(--emerald)"],[2,"margin-top","10px"],[2,"margin-top","8px","display","flex","gap","3px"],[1,"btn","btn-crimson","btn-sm",2,"margin-top","10px"],[2,"font-size","11px","color","var(--text3)","margin-bottom","5px"],[2,"display","flex","gap","4px"],[2,"background","none","border","none","cursor","pointer","font-size","20px","color","var(--border2)","transition","color .15s",3,"color"],[2,"background","none","border","none","cursor","pointer","font-size","20px","color","var(--border2)","transition","color .15s",3,"click","mouseenter","mouseleave"],[3,"color"],[2,"font-size","11px","color","var(--text3)","margin-left","6px"],[1,"btn","btn-crimson","btn-sm",2,"margin-top","10px",3,"click"],[1,"ph-row"],[1,"btn","btn-ghost-amber","btn-sm"],[2,"display","flex","gap","14px","align-items","flex-start","padding","16px 20px","margin-bottom","8px","border-radius","14px","cursor","pointer","transition","all .2s",3,"background","border"],[1,"btn","btn-ghost-amber","btn-sm",3,"click"],[2,"display","flex","gap","14px","align-items","flex-start","padding","16px 20px","margin-bottom","8px","border-radius","14px","cursor","pointer","transition","all .2s",3,"click"],[2,"width","44px","height","44px","border-radius","12px","display","flex","align-items","center","justify-content","center","font-size","22px","flex-shrink","0"],[2,"flex","1"],[2,"display","flex","justify-content","space-between","align-items","center","gap","8px","margin-bottom","3px"],[2,"font-weight","700","font-size","14px"],[2,"width","8px","height","8px","border-radius","50%","background","var(--amber)","display","inline-block"],[2,"font-size","13px","color","var(--text2)","line-height","1.55"],[2,"font-size","11px","color","var(--text3)","margin-top","5px"]],template:function(l,r){if(l&1){let c=v();n(0,"div",4)(1,"header",5)(2,"div",6),o(3,"TRIM"),n(4,"span",7),o(5,"LY"),i()(),n(6,"div",8)(7,"button",9),g("click",function(){return p(c),u(r.tab.set("notifications"))}),o(8," \u{1F514} "),d(9,ie,1,0,"div",10),i(),n(10,"div",11)(11,"div",12),o(12),i(),n(13,"div")(14,"div",13),o(15),i(),n(16,"div",14),o(17,"Customer"),i()()(),n(18,"button",15),g("click",function(){return p(c),u(r.logout())}),o(19,"Logout"),i()()(),n(20,"div",16)(21,"aside",17)(22,"div",18),o(23,"Menu"),i(),f(24,oe,5,5,"button",19,y),i(),n(26,"main",20),d(27,le,1,1)(28,se,1,1)(29,ce,1,1)(30,_e,1,1),i()(),n(31,"nav",21),f(32,ue,5,5,"button",22,y),i()(),d(34,ke,9,1,"ng-template",null,0,V)(36,We,4,1,"ng-template",null,1,V)(38,it,9,1,"ng-template",null,2,V)(40,rt,12,2,"ng-template",null,3,V)}if(l&2){let c,k;a(9),_(9,r.unreadCount()>0?9:-1),a(3),x(r.initials()),a(3),x((c=r.session())==null?null:c.name),a(9),h(r.navItems),a(3),_(27,(k=r.tab())==="explore"?27:k==="booking"?28:k==="mybookings"?29:k==="notifications"?30:-1),a(5),h(r.navItems)}},dependencies:[K,W,ee,Q,X,Z],encapsulation:2})}}return t})();export{ht as CustomerComponent};
