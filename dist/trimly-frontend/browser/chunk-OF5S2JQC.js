import{a as re,b as pe}from"./chunk-UAMAJ6S4.js";import{a as $,b as me,c as X,d as _e}from"./chunk-NOJ7QKFX.js";import{a as J,b as Q,c as K,e as le,f as se,g as de,j as ce,k as H}from"./chunk-BSUZVFBV.js";import{$ as s,Aa as D,B as r,I as g,K as f,M as w,N as B,O as T,P as Y,Pa as A,Qa as P,R as p,S as V,T as b,U as h,V as o,W as n,X as N,Z as v,_ as u,a as te,aa as ne,b as ie,ba as oe,ca as ae,ea as l,fa as x,ga as C,ha as y,ja as R,ka as z,la as O,na as F,oa as M,p as k,pa as W,qa as j,r as E,v as m,w as _,z as I,za as U}from"./chunk-EIAEMANE.js";var De=["mapEl"],ue=(t,d)=>d.id,xe=()=>[],Ie=()=>[1,2,3,4,5,6];function Be(t,d){if(t&1){let e=v();o(0,"div",4)(1,"div")(2,"div",18),l(3,"Welcome back \u{1F44B}"),n(),o(4,"div",19),l(5),n()(),o(6,"button",20),u("click",function(){m(e);let a=s();return _(a.startEditName())}),l(7),n()()}if(t&2){let e,i,a=s();r(5),C(" Hi, ",((e=a.auth.user())==null?null:e.fullName)||"Anonymous","! "),r(2),C(" \u270F\uFE0F ",(i=a.auth.user())!=null&&i.fullName?"Edit name":"Set your name"," ")}}function Ne(t,d){if(t&1){let e=v();o(0,"div",21)(1,"input",22,0),O("ngModelChange",function(a){m(e);let c=s();return z(c.editName,a)||(c.editName=a),_(a)}),u("keyup.enter",function(){m(e);let a=s();return _(a.saveName())})("keyup.escape",function(){m(e);let a=s();return _(a.editingName.set(!1))}),n(),o(3,"button",23),u("click",function(){m(e);let a=s();return _(a.saveName())}),l(4),n(),o(5,"button",24),u("click",function(){m(e);let a=s();return _(a.editingName.set(!1))}),l(6,"Cancel"),n()()}if(t&2){let e=s();r(),R("ngModel",e.editName),r(2),w("disabled",e.savingName()),r(),C(" ",e.savingName()?"...":"Save"," ")}}function Ve(t,d){if(t&1&&(o(0,"option",14),l(1),n()),t&2){let e=d.$implicit;w("value",e),r(),x(e)}}function Me(t,d){if(t&1){let e=v();o(0,"button",25),u("click",function(){let a=m(e).$implicit,c=s(2);return c.areaFilter.set(a),_(c.applyFilters())}),l(1),n()}if(t&2){let e=d.$implicit,i=s(2);T("on",i.areaFilter()===e),r(),x(e)}}function Pe(t,d){if(t&1){let e=v();o(0,"div",15)(1,"button",25),u("click",function(){m(e);let a=s();return a.areaFilter.set(""),_(a.applyFilters())}),l(2,"All Areas"),n(),b(3,Me,2,3,"button",26,V),n()}if(t&2){let e=s();r(),T("on",!e.areaFilter()),r(2),h(e.areasForCity())}}function $e(t,d){t&1&&(o(0,"div",16),N(1,"div",27,1),n())}function Re(t,d){t&1&&N(0,"div",28)}function ze(t,d){t&1&&(o(0,"div",17),b(1,Re,1,0,"div",28,V),n()),t&2&&(r(),h(M(0,Ie)))}function Le(t,d){t&1&&(o(0,"div",29)(1,"div",30),l(2,"\u2702\uFE0F"),n(),o(3,"div",31),l(4,"No shops found. Try a different search or city."),n()())}function Oe(t,d){if(t&1&&(o(0,"span",40),l(1),W(2,"number"),n()),t&2){let e=s().$implicit;r(),C("",j(2,1,e.distance,"1.1-1")," km")}}function Ae(t,d){if(t&1&&(o(0,"span",42),l(1),n()),t&2){let e=d.$implicit;r(),x(e.serviceName)}}function He(t,d){if(t&1&&(o(0,"span",42),l(1),n()),t&2){let e=s().$implicit;r(),C("+",((e.services==null?null:e.services.length)||0)-3," more")}}function We(t,d){if(t&1&&(o(0,"div",44)(1,"span",47),l(2,"\u2605"),n(),o(3,"b"),l(4),W(5,"number"),n(),o(6,"span",48),l(7),n()()),t&2){let e=s().$implicit;r(4),x(j(5,2,e.avgRating,"1.1-1")),r(3),C("(",e.totalReviews,")")}}function je(t,d){if(t&1){let e=v();o(0,"div",33),u("click",function(){let a=m(e).$implicit,c=s(2);return _(c.book(a))}),o(1,"div",34)(2,"span",35),l(3),n(),o(4,"span",36),l(5),n()(),o(6,"div",37)(7,"div",38),l(8),n(),o(9,"div",39),l(10),f(11,Oe,3,4,"span",40),n(),o(12,"div",41),b(13,Ae,2,1,"span",42,ue),f(15,He,2,1,"span",42),n(),o(16,"div",43)(17,"div"),f(18,We,8,5,"div",44),o(19,"div",45),l(20),n()(),o(21,"button",46),u("click",function(a){let c=m(e).$implicit,S=s(2);return a.stopPropagation(),_(S.book(c))}),l(22," Book \u2192 "),n()()()()}if(t&2){let e=d.$implicit,i=s(2);T("closed",!e.open),r(),B("background","linear-gradient(135deg,"+(e.color1||"#1a1200")+","+(e.color2||"#0d0d1a")+")"),r(2),x(e.emoji||"\u2702\uFE0F"),r(),Y(e.open?"bg":"br"),r(),C(" ",e.open?"\u25CF Open":"\u25CF Closed"," "),r(3),x(e.shopName),r(2),C("\u{1F4CD} ",e.location," "),r(),p(11,e.distance?11:-1),r(2),h((e.services||M(14,xe)).slice(0,3)),r(2),p(15,((e.services==null?null:e.services.length)||0)>3?15:-1),r(3),p(18,e.avgRating?18:-1),r(2),C(" From \u20B9",i.minPrice(e)," ")}}function qe(t,d){if(t&1&&(o(0,"div",17),b(1,je,23,15,"div",32,ue),n()),t&2){let e=s();r(),h(e.filtered())}}var Ce=(()=>{class t{constructor(){this.bookShop=new I,this.shopSvc=k(X),this.auth=k(A),this.shops=g([]),this.filtered=g([]),this.meta=g(null),this.loading=g(!0),this.showNearby=g(!1),this.editingName=g(!1),this.savingName=g(!1),this.editName="",this.q="",this.cityFilter=g(""),this.areaFilter=g(""),this.userLat=0,this.userLng=0}startEditName(){this.editName=this.auth.user()?.fullName||"",this.editingName.set(!0)}saveName(){this.editName.trim()&&(this.savingName.set(!0),this.auth.updateProfile(this.editName.trim()).subscribe({next:()=>{this.savingName.set(!1),this.editingName.set(!1)},error:()=>{this.savingName.set(!1),this.editingName.set(!1)}}))}ngOnInit(){this.shopSvc.getPublicShops().subscribe({next:e=>{this.shops.set(e.data||[]),this.filtered.set(e.data||[]),this.loading.set(!1)},error:()=>this.loading.set(!1)}),this.shopSvc.getLocationMeta().subscribe({next:e=>this.meta.set(e.data)})}ngAfterViewInit(){}ngOnDestroy(){this.map?.remove()}applyFilters(){let e=this.shops();this.q&&(e=e.filter(i=>i.shopName.toLowerCase().includes(this.q.toLowerCase())||i.location.toLowerCase().includes(this.q.toLowerCase()))),this.cityFilter()&&(e=e.filter(i=>i.city===this.cityFilter())),this.areaFilter()&&(e=e.filter(i=>i.area===this.areaFilter())),this.showNearby()&&this.userLat&&(e=e.map(i=>ie(te({},i),{distance:i.latitude&&i.longitude?this.haversine(this.userLat,this.userLng,+i.latitude,+i.longitude):999})).sort((i,a)=>(i.distance||999)-(a.distance||999)).filter(i=>(i.distance||999)<20)),this.filtered.set(e)}onCityChange(){this.areaFilter.set(""),this.applyFilters()}areasForCity(){let e=this.cityFilter(),i=this.meta();return!e||!i?[]:i.areasByCity[e]??[]}toggleNearby(){this.showNearby()?(this.showNearby.set(!1),this.map?.remove(),this.map=null):navigator.geolocation?.getCurrentPosition(e=>{this.userLat=e.coords.latitude,this.userLng=e.coords.longitude,this.showNearby.set(!0),this.applyFilters(),setTimeout(()=>this.initMap(),100)},()=>this.showNearby.set(!1))}initMap(){!this.mapEl||typeof L>"u"||(this.map?.remove(),this.map=L.map(this.mapEl.nativeElement,{zoomControl:!0}).setView([this.userLat,this.userLng],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap",className:"dark-tiles"}).addTo(this.map),L.circleMarker([this.userLat,this.userLng],{radius:8,color:"#3b9eff",fillColor:"#3b9eff",fillOpacity:1}).bindPopup("\u{1F4CD} You are here").addTo(this.map),this.filtered().filter(e=>e.latitude&&e.longitude).forEach(e=>{L.marker([+e.latitude,+e.longitude],{icon:L.divIcon({className:"",html:`<div style="background:var(--amber);color:#000;font-size:11px;font-weight:800;padding:4px 8px;border-radius:8px;white-space:nowrap;box-shadow:0 4px 12px rgba(0,0,0,0.4)">${e.shopName}</div>`,iconAnchor:[40,12]})}).bindPopup(`<b>${e.shopName}</b><br/>${e.location}`).addTo(this.map)}))}book(e){e.open&&this.bookShop.emit(e.id)}minPrice(e){let i=(e.services||[]).filter(a=>a.enabled).map(a=>a.price);return i.length?Math.min(...i):0}haversine(e,i,a,c){let G=(ye,Ee)=>(Ee-ye)*Math.PI/180,Z=G(e,a),Se=G(i,c),ee=Math.sin(Z/2)**2+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(Se/2)**2;return 6371*2*Math.atan2(Math.sqrt(ee),Math.sqrt(1-ee))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-customer-browse"]],viewQuery:function(i,a){if(i&1&&ne(De,5),i&2){let c;oe(c=ae())&&(a.mapEl=c.first)}},outputs:{bookShop:"bookShop"},standalone:!0,features:[F],decls:25,vars:10,consts:[["nameInput",""],["mapEl",""],[1,"page","anim-fade-up"],[2,"margin-bottom","20px","padding","20px 24px","background","var(--card)","border-radius","16px","border","1px solid var(--border)"],[2,"display","flex","align-items","center","justify-content","space-between"],[1,"ph"],[1,"ph-row"],[1,"ph-title"],[1,"ph-sub"],[1,"loc-chip",3,"click"],[2,"display","flex","gap","10px","margin-bottom","16px","flex-wrap","wrap"],["placeholder","\u{1F50D} Search shops...",1,"fi",2,"flex","2","min-width","180px",3,"ngModelChange","ngModel"],[1,"fi",2,"flex","1","min-width","120px",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"area-pills",2,"margin-bottom","14px"],[1,"anim-fade-up",2,"margin-bottom","16px"],[1,"g3"],[2,"font-size","12px","color","var(--text3)","margin-bottom","4px"],[2,"font-family","'Unbounded',sans-serif","font-size","20px","font-weight","700"],[2,"padding","8px 14px","border-radius","20px","border","1px solid var(--border2)","background","var(--card2)","color","var(--text2)","font-size","12px","cursor","pointer","display","flex","align-items","center","gap","6px",3,"click"],[2,"display","flex","gap","8px","align-items","center"],["placeholder","Your name",1,"fi",2,"flex","1","margin-bottom","0",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],[1,"btn","btn-amber","btn-sm",3,"click","disabled"],[1,"btn","btn-ghost","btn-sm",3,"click"],[1,"area-pill",3,"click"],[1,"area-pill",3,"on"],[2,"height","280px","border-radius","14px","overflow","hidden","border","1px solid var(--border)"],[2,"background","var(--card)","border-radius","18px","height","220px","border","1px solid var(--border)","animation","pulse 1.5s infinite"],[1,"empty"],[1,"ei"],[1,"et"],[1,"shop-card",3,"closed"],[1,"shop-card",3,"click"],[1,"sc-banner"],[1,"sc-emoji"],[1,"badge",2,"position","absolute","top","10px","right","10px"],[1,"sc-body"],[1,"sc-name"],[1,"sc-loc"],[1,"dist-badge"],[1,"sc-pills"],[1,"sc-pill"],[1,"sc-foot"],[2,"display","flex","align-items","center","gap","4px","font-size","13px"],[2,"font-size","11px","color","var(--text3)","margin-top","2px"],[1,"btn","btn-amber","btn-sm",3,"click"],[2,"color","var(--amber)"],[2,"color","var(--text3)"]],template:function(i,a){if(i&1&&(o(0,"div",2)(1,"div",3),f(2,Be,8,2,"div",4)(3,Ne,7,3),n(),o(4,"div",5)(5,"div",6)(6,"div")(7,"div",7),l(8,"Find Your Barber \u2702\uFE0F"),n(),o(9,"div",8),l(10),n()(),o(11,"button",9),u("click",function(){return a.toggleNearby()}),l(12),n()()(),o(13,"div",10)(14,"input",11),O("ngModelChange",function(S){return z(a.q,S)||(a.q=S),S}),u("ngModelChange",function(){return a.applyFilters()}),n(),o(15,"select",12),O("ngModelChange",function(S){return z(a.cityFilter,S)||(a.cityFilter=S),S}),u("ngModelChange",function(){return a.onCityChange()}),o(16,"option",13),l(17,"All Cities"),n(),b(18,Ve,2,2,"option",14,V),n()(),f(20,Pe,5,2,"div",15)(21,$e,3,0,"div",16)(22,ze,3,1,"div",17)(23,Le,5,0)(24,qe,3,0),n()),i&2){let c;r(2),p(2,a.editingName()?3:2),r(8),y("",a.filtered().length," shops available ",a.cityFilter()?"in "+a.cityFilter():"",""),r(2),C(" ",a.showNearby()?"\u{1F4CD} Showing Nearby":"\u{1F4CD} Near Me"," "),r(2),R("ngModel",a.q),r(),R("ngModel",a.cityFilter),r(3),h(((c=a.meta())==null?null:c.cities)||M(9,xe)),r(2),p(20,a.cityFilter()&&a.areasForCity().length>0?20:-1),r(),p(21,a.showNearby()?21:-1),r(),p(22,a.loading()?22:a.filtered().length===0?23:24)}},dependencies:[D,U,H,se,de,J,le,Q,K],encapsulation:2})}}return t})();var Ge=()=>[1,2,3,4,5];function Ye(t,d){if(t&1){let e=v();o(0,"button",7),u("click",function(){let a=m(e).$implicit,c=s(2);return _(c.selected.set(a))})("mouseenter",function(){let a=m(e).$implicit,c=s(2);return _(c.hovered.set(a))})("mouseleave",function(){m(e);let a=s(2);return _(a.hovered.set(0))}),l(1,"\u2605"),n()}if(t&2){let e=d.$implicit,i=s(2);B("color",e<=(i.hovered()||i.selected())?"var(--amber)":"var(--border2)")("transform",e<=(i.hovered()||i.selected())?"scale(1.15)":"scale(1)")}}function Ue(t,d){if(t&1&&(o(0,"span",5),l(1),n()),t&2){let e=s(2);r(),C(" ",e.labels[e.hovered()||e.selected()]," ")}}function Je(t,d){if(t&1){let e=v();o(0,"div",6)(1,"textarea",8),O("ngModelChange",function(a){m(e);let c=s(2);return z(c.review,a)||(c.review=a),_(a)}),n(),o(2,"div",9)(3,"span",10),l(4),n(),o(5,"button",11),u("click",function(){m(e);let a=s(2);return _(a.submit())}),l(6,"Submit Review"),n()()()}if(t&2){let e=s(2);r(),R("ngModel",e.review),w("placeholder","Tell us about "+e.barberName+"... (optional)"),r(3),C("",e.review.length,"/300")}}function Qe(t,d){if(t&1&&(o(0,"div",0)(1,"div",1),l(2),n(),o(3,"div",2),l(4,"How was your experience? Your review helps others."),n(),o(5,"div",3),b(6,Ye,2,4,"button",4,V),f(8,Ue,2,1,"span",5),n(),f(9,Je,7,3,"div",6),n()),t&2){let e=s();r(2),C("\u2B50 Rate ",e.barberName,""),r(4),h(M(3,Ge)),r(2),p(8,(e.hovered()||e.selected())>0?8:-1),r(),p(9,e.selected()>0?9:-1)}}var fe=(()=>{class t{constructor(){this.barberName="",this.rated=new I,this.hovered=g(0),this.selected=g(0),this.review="",this.submitted=g(!1),this.labels=["","Terrible \u{1F61E}","Poor \u{1F615}","Okay \u{1F610}","Good \u{1F60A}","Excellent \u{1F929}"]}submit(){this.selected()&&(this.rated.emit({rating:this.selected(),review:this.review.trim()}),this.submitted.set(!0))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-rating-card"]],inputs:{bookingId:"bookingId",barberName:"barberName"},outputs:{rated:"rated"},standalone:!0,features:[F],decls:1,vars:1,consts:[[1,"anim-fade-up",2,"margin-top","12px","background","linear-gradient(135deg,rgba(245,166,35,0.07),rgba(245,166,35,0.03))","border","1px solid rgba(245,166,35,0.2)","border-radius","12px","padding","14px 16px"],[2,"font-weight","700","font-size","13px","margin-bottom","2px"],[2,"font-size","11px","color","var(--text3)","margin-bottom","10px"],[2,"display","flex","gap","6px","margin-bottom","8px","align-items","center"],[2,"background","none","border","none","cursor","pointer","font-size","28px","transition","all .15s","padding","0",3,"color","transform"],[2,"font-size","12px","color","var(--amber)","font-weight","600","margin-left","4px"],[1,"anim-fade-up"],[2,"background","none","border","none","cursor","pointer","font-size","28px","transition","all .15s","padding","0",3,"click","mouseenter","mouseleave"],["rows","2","maxlength","300",1,"fi",2,"resize","none","margin-bottom","8px","font-size","13px",3,"ngModelChange","ngModel","placeholder"],[2,"display","flex","justify-content","space-between","align-items","center"],[2,"font-size","10px","color","var(--text3)"],[1,"btn","btn-amber","btn-sm",3,"click"]],template:function(i,a){i&1&&f(0,Qe,10,4,"div",0),i&2&&p(0,a.submitted()?-1:0)},dependencies:[D,H,J,Q,ce,K],encapsulation:2})}}return t})();var ve=(t,d)=>d.id,Ke=()=>[1,2,3,4,5];function Xe(t,d){t&1&&(o(0,"div",4)(1,"div",5),l(2,"\u{1F4C5}"),n(),o(3,"div",6),l(4,"No bookings yet. Browse shops to book your first appointment!"),n()())}function Ze(t,d){t&1&&(o(0,"span",18),l(1,"\u{1F504} Reschedule Pending"),n())}function et(t,d){if(t&1&&(o(0,"div",25),l(1),n()),t&2){let e=s(2).$implicit;r(),C("Reason: ",e.rescheduleReason,"")}}function tt(t,d){if(t&1){let e=v();o(0,"div",19)(1,"div",23),l(2,"\u{1F504} Reschedule Request"),n(),o(3,"div",24),l(4,"Barber proposed: "),o(5,"b"),l(6),n()(),f(7,et,2,1,"div",25),o(8,"div",26)(9,"button",27),u("click",function(){m(e);let a=s().$implicit,c=s(3);return _(c.respond(a.id,!0))}),l(10,"\u2713 Accept"),n(),o(11,"button",28),u("click",function(){m(e);let a=s().$implicit,c=s(3);return _(c.respond(a.id,!1))}),l(12,"\u2715 Decline"),n()()()}if(t&2){let e=s().$implicit;r(6),y("",e.rescheduleDate," at ",e.rescheduleTime,""),r(),p(7,e.rescheduleReason?7:-1)}}function it(t,d){if(t&1){let e=v();o(0,"button",28),u("click",function(){m(e);let a=s().$implicit,c=s(3);return _(c.cancel(a.id))}),l(1,"Cancel"),n()}}function nt(t,d){if(t&1&&(o(0,"div",11)(1,"div",12),l(2),n(),o(3,"div",13)(4,"div",14),l(5),n(),o(6,"div",15),l(7),n(),o(8,"div",15),l(9),n(),o(10,"div",16),N(11,"app-badge",17),f(12,Ze,2,0,"span",18),n(),f(13,tt,13,3,"div",19),o(14,"div",20)(15,"div",21),l(16),n(),f(17,it,2,0,"button",22),n()()()),t&2){let e=d.$implicit;r(2),x(e.shopEmoji||"\u2702\uFE0F"),r(3),x(e.shopName),r(2),x(e.servicesSnapshot),r(2),y("\u{1F4C5} ",e.bookingDate," at ",e.slotTime,""),r(2),w("status",e.status),r(),p(12,e.rescheduleStatus==="PENDING"?12:-1),r(),p(13,e.rescheduleStatus==="PENDING"?13:-1),r(3),C("\u20B9",e.totalAmount,""),r(),p(17,e.status==="PENDING"||e.status==="CONFIRMED"?17:-1)}}function ot(t,d){if(t&1&&(o(0,"div",7)(1,"div",9)(2,"div",10),l(3,"Upcoming"),n()(),b(4,nt,18,10,"div",11,ve),n()),t&2){let e=s(2);r(4),h(e.upcoming())}}function at(t,d){if(t&1){let e=v();o(0,"app-rating-card",38),u("rated",function(a){m(e);let c=s().$implicit,S=s(3);return _(S.submitRating(c.id,a))}),n()}if(t&2){let e=s().$implicit;w("bookingId",e.id)("barberName",e.shopName)}}function rt(t,d){if(t&1&&(o(0,"span"),l(1,"\u2605"),n()),t&2){let e=d.$implicit,i=s(2).$implicit;B("color",e<=i.rating?"var(--amber)":"var(--border2)")}}function lt(t,d){if(t&1&&(o(0,"span",41),l(1),n()),t&2){let e=s(2).$implicit;r(),C('"',e.review,'"')}}function st(t,d){if(t&1&&(o(0,"div",37)(1,"div",39),b(2,rt,2,2,"span",40,V),n(),f(4,lt,2,1,"span",41),n()),t&2){let e=s().$implicit;r(2),h(M(1,Ke)),r(2),p(4,e.review?4:-1)}}function dt(t,d){if(t&1&&(o(0,"div",29)(1,"div",30),l(2),n(),o(3,"div",31)(4,"div",32)(5,"div",33),l(6),n(),N(7,"app-badge",17),n(),o(8,"div",34),l(9),n(),o(10,"div",35),l(11),n(),f(12,at,1,2,"app-rating-card",36)(13,st,5,2,"div",37),n()()),t&2){let e=d.$implicit;r(2),x(e.shopEmoji||"\u2702\uFE0F"),r(4),x(e.shopName),r(),w("status",e.status),r(2),x(e.servicesSnapshot),r(2),y("\u{1F4C5} ",e.bookingDate," \xB7 \u20B9",e.totalAmount,""),r(),p(12,e.status==="COMPLETED"&&!e.rating?12:-1),r(),p(13,e.rating?13:-1)}}function ct(t,d){if(t&1&&(o(0,"div",8)(1,"div",9)(2,"div",10),l(3,"Past Bookings"),n()(),b(4,dt,14,8,"div",29,ve),n()),t&2){let e=s(2);r(4),h(e.past())}}function pt(t,d){if(t&1&&f(0,ot,6,0,"div",7)(1,ct,6,0,"div",8),t&2){let e=s();p(0,e.upcoming().length>0?0:-1),r(),p(1,e.past().length>0?1:-1)}}var ge=(()=>{class t{constructor(){this.bookings=[],this.refresh=new I,this.bookSvc=k($),this.toast=k(P)}upcoming(){return this.bookings.filter(e=>["PENDING","CONFIRMED"].includes(e.status))}past(){return this.bookings.filter(e=>["COMPLETED","CANCELLED","REJECTED"].includes(e.status))}cancel(e){this.bookSvc.cancelMyBooking(e).subscribe({next:()=>{this.toast.ok("Booking cancelled"),this.refresh.emit()},error:i=>this.toast.err("Failed",i.error?.message)})}respond(e,i){this.bookSvc.respondReschedule(e,i).subscribe({next:()=>{this.toast.ok(i?"Reschedule accepted \u2705":"Reschedule declined"),this.refresh.emit()},error:a=>this.toast.err("Failed",a.error?.message)})}submitRating(e,i){this.bookSvc.rateBooking(e,i).subscribe({next:()=>{this.toast.ok("Review submitted! \u2B50"),this.refresh.emit()},error:a=>this.toast.err("Failed",a.error?.message)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-customer-history"]],inputs:{bookings:"bookings"},outputs:{refresh:"refresh"},standalone:!0,features:[F],decls:8,vars:2,consts:[[1,"page","anim-fade-up"],[1,"ph"],[1,"ph-title"],[1,"ph-sub"],[1,"empty"],[1,"ei"],[1,"et"],[1,"card",2,"margin-bottom","14px"],[1,"card"],[1,"ch"],[1,"ct"],[1,"bk"],[1,"bk-av"],[1,"bk-body"],[1,"bk-name"],[1,"bk-detail"],[1,"bk-tags"],[3,"status"],[1,"badge","by"],[2,"margin-top","10px","padding","10px","background","var(--amber-dim)","border","1px solid rgba(245,166,35,0.2)","border-radius","8px","font-size","12px"],[1,"bk-actions"],[1,"bk-amt"],[1,"btn","btn-crimson","btn-sm"],[2,"font-weight","700","color","var(--amber)","margin-bottom","4px"],[2,"color","var(--text2)"],[2,"color","var(--text3)","margin-top","2px"],[2,"display","flex","gap","8px","margin-top","8px"],[1,"btn","btn-emerald","btn-sm",3,"click"],[1,"btn","btn-crimson","btn-sm",3,"click"],[1,"pb-card"],[1,"pb-ico"],[2,"flex","1","min-width","0"],[2,"display","flex","align-items","center","justify-content","space-between","gap","8px"],[2,"font-size","13px","font-weight","700"],[2,"font-size","12px","color","var(--text2)","margin-top","2px"],[2,"font-size","11px","color","var(--text3)","margin-top","2px"],[3,"bookingId","barberName"],[2,"margin-top","8px","display","flex","align-items","center","gap","6px"],[3,"rated","bookingId","barberName"],[2,"display","flex","gap","2px"],[3,"color"],[2,"font-size","12px","color","var(--text2)"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),l(3,"My Bookings \u{1F4C5}"),n(),o(4,"div",3),l(5),n()(),f(6,Xe,5,0,"div",4)(7,pt,2,2),n()),i&2&&(r(5),C("",a.bookings.length," total bookings"),r(),p(6,a.bookings.length===0?6:7))},dependencies:[D,_e,fe],encapsulation:2})}}return t})();var mt=(t,d)=>d.id;function _t(t,d){if(t&1&&(l(0," \u2705 Your booking for "),o(1,"b"),l(2),n(),l(3," on "),o(4,"b"),l(5),n(),l(6)),t&2){let e=s().$implicit;r(2),x(e.servicesSnapshot),r(3),y("",e.bookingDate," at ",e.slotTime,""),r(),C(" has been confirmed by ",e.shopName,". See you then! ")}}function ut(t,d){if(t&1&&(l(0," \u23F3 Your booking request for "),o(1,"b"),l(2),n(),l(3," on "),o(4,"b"),l(5),n(),l(6," is waiting for barber confirmation. ")),t&2){let e=s().$implicit;r(2),x(e.servicesSnapshot),r(3),y("",e.bookingDate," at ",e.slotTime,"")}}function xt(t,d){if(t&1&&(l(0," \u274C Your booking for "),o(1,"b"),l(2),n(),l(3," was declined. Please book another slot. ")),t&2){let e=s().$implicit;r(2),x(e.servicesSnapshot)}}function Ct(t,d){if(t&1&&(l(0),o(1,"b"),l(2),n(),l(3)),t&2){let e=s().$implicit;C(" \u{1F504} ",e.shopName," wants to reschedule your booking to "),r(2),y("",e.rescheduleDate," at ",e.rescheduleTime,""),r(),C(". ",e.rescheduleReason?"Reason: "+e.rescheduleReason:""," ")}}function ft(t,d){if(t&1){let e=v();o(0,"div",10)(1,"button",12),u("click",function(){m(e);let a=s().$implicit,c=s();return _(c.respond(a.id,!0))}),l(2,"\u2713 Accept"),n(),o(3,"button",13),u("click",function(){m(e);let a=s().$implicit,c=s();return _(c.respond(a.id,!1))}),l(4,"\u2715 Decline"),n()()}}function vt(t,d){if(t&1&&(o(0,"div",4)(1,"div",6),l(2,"\u{1F4AC}"),n(),o(3,"div",7)(4,"div",8),l(5),n(),o(6,"div",9),f(7,_t,7,4)(8,ut,7,3)(9,xt,4,1)(10,Ct,4,4),n(),f(11,ft,5,0,"div",10),o(12,"div",11),l(13),n()()()),t&2){let e=d.$implicit,i=s();r(5),C("TRIMLY \xB7 ",e.shopName,""),r(2),p(7,e.status==="CONFIRMED"?7:e.status==="PENDING"?8:e.status==="REJECTED"?9:e.rescheduleStatus==="PENDING"?10:-1),r(4),p(11,e.rescheduleStatus==="PENDING"?11:-1),r(2),x(i.relTime(e.createdAt))}}function gt(t,d){t&1&&(o(0,"div",5)(1,"div",14),l(2,"\u{1F514}"),n(),o(3,"div",15),l(4,"All caught up! No new notifications."),n()())}var be=(()=>{class t{constructor(){this.bookings=[],this.action=new I,this.bookSvc=k($),this.toast=k(P)}active(){return this.bookings.filter(e=>["PENDING","CONFIRMED","REJECTED"].includes(e.status)||e.rescheduleStatus==="PENDING")}respond(e,i){this.bookSvc.respondReschedule(e,i).subscribe({next:()=>{this.toast.ok(i?"Reschedule accepted \u2705":"Declined"),this.action.emit()},error:a=>this.toast.err("Failed",a.error?.message)})}relTime(e){if(!e)return"";let i=Date.now()-new Date(e).getTime(),a=Math.floor(i/6e4);if(a<1)return"Just now";if(a<60)return a+"m ago";let c=Math.floor(a/60);return c<24?c+"h ago":Math.floor(c/24)+"d ago"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-customer-notifications"]],inputs:{bookings:"bookings"},outputs:{action:"action"},standalone:!0,features:[F],decls:9,vars:1,consts:[[1,"page","anim-fade-up"],[1,"ph"],[1,"ph-title"],[1,"ph-sub"],[1,"wa-notif"],[1,"empty"],[1,"wa-logo"],[1,"wa-content"],[1,"wa-from"],[1,"wa-msg"],[2,"display","flex","gap","8px","margin-top","10px"],[1,"wa-time"],[1,"btn","btn-emerald","btn-sm",3,"click"],[1,"btn","btn-crimson","btn-sm",3,"click"],[1,"ei"],[1,"et"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),l(3,"Notifications \u{1F514}"),n(),o(4,"div",3),l(5,"Recent activity on your bookings"),n()(),b(6,vt,14,4,"div",4,mt),f(8,gt,5,0,"div",5),n()),i&2&&(r(6),h(a.active()),r(2),p(8,a.active().length===0?8:-1))},dependencies:[D],encapsulation:2})}}return t})();var bt=(t,d)=>d.n,ht=(t,d)=>d.id,he=(t,d)=>d.label;function kt(t,d){if(t&1&&(o(0,"div",12),l(1),n()),t&2){let e=s(3);r(),x(e.shop().bio)}}function wt(t,d){if(t&1&&(o(0,"span",14),l(1),W(2,"number"),n()),t&2){let e=s(3);r(),y("\u2605 ",j(2,2,e.shop().avgRating,"1.1-1")," (",e.shop().totalReviews,")")}}function St(t,d){if(t&1){let e=v();o(0,"div",7)(1,"div",8),l(2),n(),o(3,"div",9)(4,"div",10),l(5),n(),o(6,"div",11),l(7),n(),f(8,kt,2,1,"div",12),o(9,"div",13),f(10,wt,3,5,"span",14),o(11,"span",15),l(12),n(),o(13,"span",16),l(14),n()()()(),o(15,"button",17),u("click",function(){m(e);let a=s(2);return _(a.step.set(1))}),l(16,"Book Here \u2192"),n()}if(t&2){let e=s(2);r(),B("background","linear-gradient(135deg,"+(e.shop().color1||"#1a1200")+","+(e.shop().color2||"#0d0d1a")+")"),r(),C(" ",e.shop().emoji||"\u2702\uFE0F"," "),r(3),x(e.shop().shopName),r(2),C("\u{1F4CD} ",e.shop().location,""),r(),p(8,e.shop().bio?8:-1),r(2),p(10,e.shop().avgRating?10:-1),r(),Y(e.shop().open?"bg":"br"),r(),x(e.shop().open?"\u25CF Open":"\u25CF Closed"),r(2),C("\u{1F4BA} ",e.shop().seats," seats")}}function yt(t,d){if(t&1&&(o(0,"div",5),f(1,St,17,11),n()),t&2){let e=s();r(),p(1,e.shop()?1:-1)}}function Et(t,d){if(t&1&&N(0,"div",23),t&2){let e=s().$implicit,i=s(2);T("done",i.step()>e.n)}}function Tt(t,d){if(t&1&&(o(0,"div",19)(1,"div",20),l(2),n(),o(3,"div",21),l(4),n()(),f(5,Et,1,2,"div",22)),t&2){let e=d.$implicit,i=d.$index,a=s(2);r(),T("done",a.step()>e.n)("active",a.step()===e.n)("todo",a.step()<e.n),r(),C(" ",a.step()>e.n?"\u2713":e.n," "),r(),T("done",a.step()>e.n)("active",a.step()===e.n)("todo",a.step()<e.n),r(),x(e.label),r(),p(5,i<a.steps.length-1?5:-1)}}function Ft(t,d){t&1&&(o(0,"span",33),l(1,"\u2713"),n())}function Dt(t,d){if(t&1){let e=v();o(0,"div",26),u("click",function(){let a=m(e).$implicit,c=s(3);return _(c.toggleSvc(a.id))}),o(1,"div",27),l(2),n(),o(3,"div",28)(4,"div",29),l(5),n(),o(6,"div",30),l(7),n()(),o(8,"div",31)(9,"div",32),l(10),n(),f(11,Ft,2,0,"span",33),n()()}if(t&2){let e=d.$implicit,i=s(3);B("border-color",i.selected().has(e.id)?"var(--amber)":"")("background",i.selected().has(e.id)?"var(--amber-dim)":""),r(2),x(e.icon||"\u2702\uFE0F"),r(3),x(e.serviceName),r(2),C("\u23F1 ",e.durationMinutes," min"),r(3),C("\u20B9",e.price,""),r(),p(11,i.selected().has(e.id)?11:-1)}}function It(t,d){if(t&1){let e=v();o(0,"div",34)(1,"div",35),l(2,"Selected:"),n(),o(3,"div",36),l(4),n(),o(5,"div",37),l(6),n(),o(7,"div",38),l(8),n()(),o(9,"button",39),u("click",function(){m(e);let a=s(3);return _(a.step.set(2))}),l(10," Continue \u2192 "),n()}if(t&2){let e=s(3);r(4),x(e.selectedNames()),r(2),C("Total \u23F1 ",e.totalDuration()," min"),r(2),C("\u20B9",e.totalPrice(),"")}}function Bt(t,d){if(t&1&&(o(0,"div",5)(1,"div",24),l(2,"Choose Services"),n(),b(3,Dt,12,9,"div",25,ht),f(5,It,11,3),n()),t&2){let e=s(2);r(3),h(e.enabledServices()),r(2),p(5,e.selected().size>0?5:-1)}}function Nt(t,d){if(t&1){let e=v();o(0,"div",44),u("click",function(){let a=m(e).$index,c=s(3);return c.selDateIdx.set(a),c.selSlot.set(null),_(c.loadSlots())}),o(1,"div",45),l(2),n(),o(3,"div",46),l(4),n(),o(5,"div",47),l(6),n()()}if(t&2){let e=d.$implicit,i=d.$index,a=s(3);B("border-color",a.selDateIdx()===i?"var(--amber)":"var(--border)")("background",a.selDateIdx()===i?"var(--amber-dim)":"var(--card)"),r(2),x(e.label),r(),B("color",a.selDateIdx()===i?"var(--amber)":"var(--text)"),r(),x(e.day),r(2),x(e.month)}}function Vt(t,d){t&1&&(o(0,"div",42)(1,"div",48),l(2,"Loading slots..."),n()())}function Mt(t,d){if(t&1&&(o(0,"div",52),l(1),n()),t&2){let e=s().$implicit;r(),C("",e.seatsLeft," left")}}function Pt(t,d){if(t&1){let e=v();o(0,"div",51),u("click",function(){let a=m(e).$implicit,c=s(4);return _(!a.taken&&a.available&&c.selSlot.set(a.label))}),l(1),f(2,Mt,2,1,"div",52),n()}if(t&2){let e,i=d.$implicit,a=s(4);T("s-sel",a.selSlot()===i.label)("s-off",i.taken||!i.available),r(),C(" ",i.label," "),r(),p(2,i.seatsLeft>0&&i.seatsLeft<(((e=a.shop())==null?null:e.seats)||0)?2:-1)}}function $t(t,d){if(t&1&&(o(0,"div",49),b(1,Pt,3,6,"div",50,he),n()),t&2){let e=s(3);r(),h(e.slots())}}function Rt(t,d){if(t&1){let e=v();o(0,"button",53),u("click",function(){m(e);let a=s(3);return _(a.step.set(3))}),l(1," Confirm Time \u2192 "),n()}}function zt(t,d){if(t&1&&(o(0,"div",5)(1,"div",24),l(2,"Pick a Date & Time"),n(),o(3,"div",40),b(4,Nt,7,9,"div",41,he),n(),f(6,Vt,3,0,"div",42)(7,$t,3,0)(8,Rt,2,0,"button",43),n()),t&2){let e=s(2);r(4),h(e.dateOptions),r(2),p(6,e.slotsLoading()?6:7),r(2),p(8,e.selSlot()?8:-1)}}function Lt(t,d){if(t&1){let e=v();o(0,"div",5)(1,"div",24),l(2,"Confirm Booking"),n(),o(3,"div",54)(4,"div",55)(5,"span",56),l(6,"Shop"),n(),o(7,"span",57),l(8),n()(),o(9,"div",55)(10,"span",56),l(11,"Services"),n(),o(12,"span",58),l(13),n()(),o(14,"div",55)(15,"span",56),l(16,"Date"),n(),o(17,"span",57),l(18),n()(),o(19,"div",55)(20,"span",56),l(21,"Time"),n(),o(22,"span",57),l(23),n()(),o(24,"div",55)(25,"span",56),l(26,"Duration"),n(),o(27,"span"),l(28),n()(),o(29,"div",55)(30,"span",56),l(31,"Name"),n(),o(32,"span",57),l(33),n()(),o(34,"div",55)(35,"span",56),l(36,"Total"),n(),o(37,"div",59),l(38),n()()(),o(39,"div",60),l(40," \u{1F4AC} You'll get a WhatsApp confirmation when the barber accepts your booking. Pay at the shop. "),n(),o(41,"button",61),u("click",function(){m(e);let a=s(2);return _(a.confirmBooking())}),l(42),n(),o(43,"button",62),u("click",function(){m(e);let a=s(2);return _(a.step.set(2))}),l(44,"\u2190 Change slot"),n()()}if(t&2){let e,i=s(2);r(8),x(i.shop().shopName),r(5),x(i.selectedNames()),r(5),x(i.dateOptions[i.selDateIdx()].fullDate),r(5),x(i.selSlot()),r(5),C("~",i.totalDuration()," min"),r(5),x((e=i.auth.user())==null?null:e.fullName),r(5),C("\u20B9",i.totalPrice(),""),r(3),w("disabled",i.booking()),r(),C(" ",i.booking()?"Booking...":"\u{1F3AF} Confirm Booking"," ")}}function Ot(t,d){if(t&1&&(o(0,"div",18),b(1,Tt,6,15,null,null,bt),n(),f(3,Bt,6,1,"div",5)(4,zt,9,2,"div",5)(5,Lt,45,9,"div",5)),t&2){let e=s();r(),h(e.steps),r(2),p(3,e.step()===1?3:-1),r(),p(4,e.step()===2?4:-1),r(),p(5,e.step()===3?5:-1)}}function At(t,d){if(t&1){let e=v();o(0,"div",6)(1,"div",63),l(2,"\u{1F389}"),n(),o(3,"div",64),l(4,"BOOKED!"),n(),o(5,"div",65),l(6," Your appointment at "),o(7,"b"),l(8),n(),l(9," is confirmed."),N(10,"br"),l(11," We'll notify you on WhatsApp when the barber accepts. "),n(),o(12,"div",66)(13,"div",55)(14,"span",56),l(15,"Services"),n(),o(16,"span"),l(17),n()(),o(18,"div",55)(19,"span",56),l(20,"When"),n(),o(21,"span"),l(22),n()(),o(23,"div",55)(24,"span",56),l(25,"Amount"),n(),o(26,"div",59),l(27),n()()(),o(28,"div",67)(29,"div",68),l(30,"\u{1F4AC} WHATSAPP"),n(),o(31,"div",69),l(32,"Confirmation message sent to your WhatsApp"),n()(),o(33,"button",17),u("click",function(){m(e);let a=s();return _(a.done.emit(!0))}),l(34,"View My Bookings \u2192"),n()()}if(t&2){let e,i=s();r(8),x((e=i.shop())==null?null:e.shopName),r(9),x(i.selectedNames()),r(5),y("",i.dateOptions[i.selDateIdx()].fullDate," at ",i.selSlot(),""),r(5),C("\u20B9",i.totalPrice(),"")}}var ke=(()=>{class t{constructor(){this.done=new I,this.back=new I,this.shopSvc=k(X),this.bookSvc=k($),this.toast=k(P),this.auth=k(A),this.shop=g(null),this.step=g(0),this.selected=g(new Set),this.slots=g([]),this.selSlot=g(null),this.selDateIdx=g(0),this.slotsLoading=g(!1),this.booking=g(!1),this.success=g(!1),this.steps=[{n:1,label:"Services"},{n:2,label:"Date & Time"},{n:3,label:"Confirm"}],this.dateOptions=this.buildDates()}ngOnInit(){this.shopSvc.getShopById(this.shopId).subscribe({next:e=>{this.shop.set(e.data),this.step.set(1)},error:()=>this.back.emit()})}buildDates(){let e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return[0,1,2].map(a=>{let c=new Date;return c.setDate(c.getDate()+a),{label:a===0?"Today":a===1?"Tomorrow":e[c.getDay()],day:c.getDate(),month:i[c.getMonth()],fullDate:`${c.getDate()} ${i[c.getMonth()]} ${c.getFullYear()}`,iso:c.toISOString().split("T")[0]}})}enabledServices(){return(this.shop()?.services||[]).filter(e=>e.enabled)}toggleSvc(e){let i=new Set(this.selected());i.has(e)?i.delete(e):i.add(e),this.selected.set(i)}selectedNames(){return(this.shop()?.services||[]).filter(e=>this.selected().has(e.id)).map(e=>e.serviceName).join(" + ")}totalDuration(){return(this.shop()?.services||[]).filter(e=>this.selected().has(e.id)).reduce((e,i)=>e+i.durationMinutes,0)}totalPrice(){return(this.shop()?.services||[]).filter(e=>this.selected().has(e.id)).reduce((e,i)=>e+i.price,0)}loadSlots(){if(!this.shop())return;this.slotsLoading.set(!0);let e=this.dateOptions[this.selDateIdx()].iso;this.shopSvc.getSlots(this.shopId,e).subscribe({next:i=>{this.slots.set(i.data?.slots||[]),this.slotsLoading.set(!1)},error:()=>this.slotsLoading.set(!1)})}confirmBooking(){if(!this.selSlot()||this.selected().size===0)return;this.booking.set(!0);let[e,i]=this.selSlot().split(" "),[a,c]=e.split(":").map(Number),S=i==="PM"&&a!==12?a+12:i==="AM"&&a===12?0:a,G=`${String(S).padStart(2,"0")}:${String(c).padStart(2,"0")}`;this.bookSvc.createBooking({shopId:this.shopId,serviceIds:Array.from(this.selected()),bookingDate:this.dateOptions[this.selDateIdx()].iso,slotTime:G,seats:1}).subscribe({next:()=>{this.booking.set(!1),this.success.set(!0)},error:Z=>{this.booking.set(!1),this.toast.err("Booking failed",Z.error?.message||"Please try again")}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-booking-flow"]],inputs:{shopId:"shopId"},outputs:{done:"done",back:"back"},standalone:!0,features:[F],decls:10,vars:4,consts:[[2,"min-height","100vh","background","var(--bg)"],[2,"display","flex","align-items","center","gap","16px","padding","0 24px","height","58px","border-bottom","1px solid var(--border)","background","rgba(9,9,14,.95)","position","sticky","top","0","z-index","100","backdrop-filter","blur(20px)"],[1,"btn","btn-ghost","btn-sm",3,"click"],[2,"font-family","'Unbounded',sans-serif","font-size","14px","font-weight","700"],[2,"max-width","640px","margin","0 auto","padding","28px 20px"],[1,"anim-fade-up"],[1,"anim-fade-up",2,"text-align","center","padding","40px 20px"],[2,"border-radius","20px","overflow","hidden","border","1px solid var(--border)","margin-bottom","20px"],[2,"height","120px","display","flex","align-items","center","justify-content","center","font-size","64px"],[2,"padding","20px"],[2,"font-family","'Unbounded',sans-serif","font-size","22px","font-weight","700","margin-bottom","4px"],[2,"color","var(--text2)","font-size","13px","margin-bottom","12px"],[2,"font-size","13px","color","var(--text2)","line-height","1.7","margin-bottom","12px"],[2,"display","flex","gap","8px","flex-wrap","wrap"],[1,"badge","by"],[1,"badge"],[1,"badge","bm"],[1,"btn","btn-amber","btn-block","btn-lg",3,"click"],[1,"steps",2,"margin-bottom","28px"],[1,"step-n"],[1,"step-c"],[1,"step-l"],[1,"step-line",3,"done"],[1,"step-line"],[2,"margin-bottom","16px","font-family","'Unbounded',sans-serif","font-size","16px","font-weight","700"],[1,"svc",2,"cursor","pointer",3,"border-color","background"],[1,"svc",2,"cursor","pointer",3,"click"],[1,"svc-ico"],[1,"svc-info"],[1,"svc-name"],[1,"svc-meta"],[2,"display","flex","flex-direction","column","align-items","flex-end","gap","4px"],[1,"svc-price"],[2,"font-size","16px"],[1,"sbox",2,"margin-top","16px"],[2,"font-size","12px","color","var(--text2)","margin-bottom","6px"],[2,"font-weight","700"],[2,"color","var(--text2)","font-size","12px","margin-top","4px"],[2,"font-family","'Unbounded',sans-serif","font-size","24px","font-weight","700","color","var(--amber)","margin-top","8px"],[1,"btn","btn-amber","btn-block","btn-lg",2,"margin-top","12px",3,"click"],[2,"display","flex","gap","10px","margin-bottom","20px"],[2,"flex","1","text-align","center","padding","14px 8px","border-radius","12px","cursor","pointer","border","2px solid","transition","all .15s",3,"border-color","background"],[1,"empty",2,"padding","20px"],[1,"btn","btn-amber","btn-block","btn-lg",2,"margin-top","20px"],[2,"flex","1","text-align","center","padding","14px 8px","border-radius","12px","cursor","pointer","border","2px solid","transition","all .15s",3,"click"],[2,"font-size","11px","color","var(--text3)","text-transform","uppercase","letter-spacing","1px","margin-bottom","4px"],[2,"font-family","'Unbounded',sans-serif","font-size","22px","font-weight","700"],[2,"font-size","11px","color","var(--text2)"],[1,"et"],[1,"slot-grid"],[1,"slot",3,"s-sel","s-off"],[1,"slot",3,"click"],[2,"font-size","9px","color","var(--amber)","margin-top","2px"],[1,"btn","btn-amber","btn-block","btn-lg",2,"margin-top","20px",3,"click"],[1,"sbox"],[1,"srow"],[2,"color","var(--text2)"],[2,"font-weight","600"],[2,"font-weight","600","text-align","right","max-width","60%"],[1,"stotal"],[2,"margin-top","14px","padding","12px 14px","background","rgba(37,211,102,0.05)","border","1px solid rgba(37,211,102,0.15)","border-radius","10px","font-size","12px","color","var(--text2)"],[1,"btn","btn-amber","btn-block","btn-lg",2,"margin-top","16px",3,"click","disabled"],[1,"btn","btn-ghost","btn-block",2,"margin-top","8px",3,"click"],[2,"font-size","72px","margin-bottom","16px","animation","popIn .5s"],[2,"font-family","'Unbounded',sans-serif","font-size","28px","font-weight","900","margin-bottom","8px"],[2,"color","var(--text2)","margin-bottom","24px","line-height","1.7"],[1,"sbox",2,"text-align","left","margin-bottom","20px"],[2,"background","linear-gradient(135deg,#1a2e1a,#0f1f0f)","border","1px solid rgba(37,211,102,0.2)","border-radius","12px","padding","14px","margin-bottom","20px"],[2,"font-size","11px","font-weight","700","color","#25d366","margin-bottom","4px"],[2,"font-size","13px"]],template:function(i,a){if(i&1&&(o(0,"div",0)(1,"nav",1)(2,"button",2),u("click",function(){return a.back.emit()}),l(3,"\u2190 Back"),n(),o(4,"div",3),l(5),n()(),o(6,"div",4),f(7,yt,2,1,"div",5)(8,Ot,6,3)(9,At,35,5,"div",6),n()()),i&2){let c;r(5),x(((c=a.shop())==null?null:c.shopName)||"Book Appointment"),r(2),p(7,a.step()===0&&!a.success()?7:-1),r(),p(8,a.step()>0&&!a.success()?8:-1),r(),p(9,a.success()?9:-1)}},dependencies:[D,U,H],encapsulation:2})}}return t})();var we=(t,d)=>d.tab;function Ht(t,d){if(t&1){let e=v();o(0,"app-policy-page",1),u("back",function(){m(e);let a=s();return _(a.policyType.set(null))}),n()}if(t&2){let e=s();w("type",e.policyType())}}function Wt(t,d){if(t&1){let e=v();o(0,"app-booking-flow",2),u("done",function(a){m(e);let c=s();return _(c.onBookingDone(a))})("back",function(){m(e);let a=s();return _(a.bookingShopId.set(null))}),n()}if(t&2){let e=s();w("shopId",e.bookingShopId())}}function jt(t,d){if(t&1&&(o(0,"span",14),l(1),n()),t&2){let e=s(3);r(),x(e.pendingNotifs())}}function qt(t,d){if(t&1){let e=v();o(0,"button",13),u("click",function(){let a=m(e).$implicit,c=s(2);return _(c.tab.set(a.tab))}),o(1,"span"),l(2),n(),l(3),f(4,jt,2,1,"span",14),n()}if(t&2){let e=d.$implicit,i=s(2);T("on",i.tab()===e.tab),r(2),x(e.icon),r(),C(" ",e.label," "),r(),p(4,e.tab==="notif"&&i.pendingNotifs()>0?4:-1)}}function Gt(t,d){if(t&1){let e=v();o(0,"app-customer-browse",15),u("bookShop",function(a){m(e);let c=s(2);return _(c.bookingShopId.set(a))}),n()}}function Yt(t,d){if(t&1){let e=v();o(0,"app-customer-history",16),u("refresh",function(){m(e);let a=s(2);return _(a.loadBookings())}),n()}if(t&2){let e=s(2);w("bookings",e.myBookings())}}function Ut(t,d){if(t&1){let e=v();o(0,"app-customer-notifications",17),u("action",function(){m(e);let a=s(2);return _(a.loadBookings())}),n()}if(t&2){let e=s(2);w("bookings",e.myBookings())}}function Jt(t,d){if(t&1&&(o(0,"span",19),l(1),n()),t&2){let e=s(3);r(),x(e.pendingNotifs())}}function Qt(t,d){if(t&1){let e=v();o(0,"button",18),u("click",function(){let a=m(e).$implicit,c=s(2);return _(c.tab.set(a.tab))}),f(1,Jt,2,1,"span",19),o(2,"span",20),l(3),n(),l(4),n()}if(t&2){let e=d.$implicit,i=s(2);T("on",i.tab()===e.tab),r(),p(1,e.tab==="notif"&&i.pendingNotifs()>0?1:-1),r(2),x(e.icon),r(),C("",e.label," ")}}function Kt(t,d){if(t&1){let e=v();o(0,"div",3)(1,"app-topbar",4),u("notifClick",function(){m(e);let a=s();return _(a.tab.set("notif"))}),n(),o(2,"div",5),b(3,qt,5,5,"button",6,we),n(),o(5,"div",7),f(6,Gt,1,0,"app-customer-browse")(7,Yt,1,1,"app-customer-history",8)(8,Ut,1,1,"app-customer-notifications",8),n(),o(9,"div",9)(10,"app-footer",10),u("policyClick",function(a){m(e);let c=s();return _(c.policyType.set(a))}),n()(),o(11,"nav",11),b(12,Qt,5,5,"button",12,we),n()()}if(t&2){let e=s();r(),w("notifCount",e.pendingNotifs()),r(2),h(e.navItems),r(3),p(6,e.tab()==="browse"?6:-1),r(),p(7,e.tab()==="history"?7:-1),r(),p(8,e.tab()==="notif"?8:-1),r(4),h(e.navItems)}}var on=(()=>{class t{constructor(){this.auth=k(A),this.bookingSvc=k($),this.toast=k(P),this.tab=g("browse"),this.myBookings=g([]),this.bookingShopId=g(null),this.policyType=g(null),this.pendingNotifs=g(0),this.navItems=[{tab:"browse",icon:"\u{1F50D}",label:"Browse"},{tab:"history",icon:"\u{1F4C5}",label:"My Bookings"},{tab:"notif",icon:"\u{1F514}",label:"Notifications"}]}ngOnInit(){this.loadBookings()}loadBookings(){this.bookingSvc.getMyBookings().subscribe({next:e=>{this.myBookings.set(e.data||[]),this.pendingNotifs.set((e.data||[]).filter(i=>i.rescheduleStatus==="PENDING"||i.status==="PENDING").length)},error:()=>{}})}onBookingDone(e){this.bookingShopId.set(null),e&&(this.loadBookings(),this.tab.set("history"))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["app-customer"]],standalone:!0,features:[F],decls:3,vars:1,consts:[[3,"type"],[3,"back","type"],[3,"done","back","shopId"],[2,"display","flex","flex-direction","column","min-height","100vh"],[3,"notifClick","notifCount"],[1,"desk-tabs"],[1,"dt",3,"on"],[1,"main",2,"flex","1"],[3,"bookings"],[1,"hide-mobile"],[3,"policyClick"],[1,"mobile-nav"],[1,"mni",3,"on"],[1,"dt",3,"click"],[1,"dt-badge"],[3,"bookShop"],[3,"refresh","bookings"],[3,"action","bookings"],[1,"mni",3,"click"],[1,"mni-badge"],[1,"mni-icon"]],template:function(i,a){i&1&&f(0,Ht,1,1,"app-policy-page",0)(1,Wt,1,1)(2,Kt,14,4),i&2&&p(0,a.policyType()?0:a.bookingShopId()?1:2)},dependencies:[D,me,re,pe,Ce,ge,be,ke],styles:[".hide-mobile[_ngcontent-%COMP%]{@media (max-width:760px){display:none}}.desk-tabs[_ngcontent-%COMP%]{display:flex;gap:4px;padding:10px 24px 0;border-bottom:1px solid var(--border);background:var(--bg);@media (max-width:760px){display:none}}.dt[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 20px;border:none;background:none;color:var(--text3);font-family:DM Sans,sans-serif;font-size:13px;font-weight:600;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .15s;position:relative;border-radius:8px 8px 0 0;&:hover{color:var(--text1);background:var(--card)}&.on{color:var(--amber);border-bottom-color:var(--amber);background:var(--amber-dim)}}.dt-badge[_ngcontent-%COMP%]{background:var(--crimson);color:#fff;font-size:10px;font-weight:700;padding:1px 6px;border-radius:10px;min-width:18px;text-align:center}"]})}}return t})();export{on as CustomerComponent};
